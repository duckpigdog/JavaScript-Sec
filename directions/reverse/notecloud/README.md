# NoteCloud - JavaScript逆向工程挑战第二关

## 🎯 挑战目标

NoteCloud是一个在线笔记同步服务，你需要逆向分析其签名算法，构造合法的API请求来获取笔记数据。

## 🔗 目标接口

```
GET /api/v3/note/list?u={userId}&p={page}&t={timestamp}&s={signature}
```

### 参数说明

| 参数 | 含义 | 备注 |
|------|------|------|
| u | userId | 用户ID |
| p | page | 当前页码 |
| t | timestamp | 秒级时间戳 |
| s | signature | 三层签名结果，本关卡核心 |

## 🧩 挑战特点

### 1. 单字符参数设计
- 所有参数都是单字符，避免简单的关键词搜索
- 强制使用XHR/fetch断点来定位签名逻辑

### 2. JSON.parse混淆
- 三种JSON.parse使用场景：
  - **原生JSON.parse**：业务配置解析
  - **无关噪音JSON.parse**：埋点和演示数据
  - **自定义JSON解析器**：参与签名构造的关键逻辑

### 3. 三层签名算法
1. **第一层**：结构重排 + Base64变种编码
2. **第二层**：自定义流加密（RC4风格）
3. **第三层**：HMAC + 截断 + 混淆

### 4. 反搜索设计
- URL构造使用数组拼接和变量组合
- 不出现完整的`"s="`或`"/api/v3/note/list"`字面量

## 🚀 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 启动服务器
```bash
npm start
```

### 3. 访问应用
打开浏览器访问：http://localhost:3000

## 🕵️ 逆向分析步骤

### 第一步：抓包分析
1. 打开DevTools → Network面板
2. 点击"同步笔记"按钮
3. 观察请求URL格式和参数

### 第二步：XHR断点定位
1. 在DevTools中设置XHR/fetch断点
2. 条件：URL包含`/api/v3/note/list`
3. 重新点击"同步笔记"，断点触发后分析调用栈

### 第三步：追踪签名逻辑
1. 在调用栈中找到`app.js`中的请求构造函数
2. 发现调用了`NCGuard.calc(u, p)`方法
3. 进入`guard.js`分析签名算法

### 第四步：分析JSON.parse混淆
1. 给`JSON.parse`和`JX.parse`下断点
2. 观察哪些断点在签名生成前被触发
3. 分析`JX.parse`对`"SEC|"`前缀字符串的特殊处理

### 第五步：复现签名算法
1. 提取SEC配置中的salt和key
2. 实现三层加密逻辑：
   - 结构重排 + Base64变种
   - RC4流加密
   - HMAC + 截断 + 反转 + 交错

### 第六步：构造合法请求
使用复现的算法生成签名，构造API请求获取笔记数据。

## 🔍 关键代码位置

### 核心签名逻辑
- **文件**：`guard.js`
- **方法**：`NCGuard.calc(u, p)`
- **自定义JSON解析器**：`JX.parse()`

### URL构造逻辑
- **文件**：`app.js`
- **方法**：`buildApiUrl()`
- **特点**：使用数组拼接避免直接字符串搜索

### 配置解析
- **文件**：`config.js`
- **功能**：加载`/config/notecloud_v3.json`中的SEC配置
- **注意**：使用原生JSON.parse解析配置文件

## 🛠️ 技术栈

- **前端**：原生JavaScript，无框架依赖
- **后端**：Node.js + Express
- **加密**：MD5, SHA256, RC4, HMAC, 自定义Base64

## 📋 挑战验证

成功标准：
- ✅ 能够通过XHR断点定位签名逻辑
- ✅ 能够区分原生JSON.parse和自定义JSON解析器
- ✅ 能够完整复现三层签名算法
- ✅ 能够构造合法请求获取笔记数据

## 💡 提示

1. **XHR断点**是关键，强制使用网络请求断点而非字符串搜索
2. **调用栈分析**能帮助快速定位核心逻辑
3. **JSON.parse混淆**需要仔细观察解析的字符串内容和调用时机
4. **三层加密**每一层都需要仔细分析，不能跳过任何一步

## 🎉 完成挑战

当你成功复现签名算法并获取到笔记数据时，恭喜你完成了NoteCloud挑战！你已经掌握了：

- XHR断点调试技巧
- 调用栈分析方法
- JSON.parse混淆识别
- 多层加密算法复现
- 反搜索绕过技术

---

**祝你好运！🍀**